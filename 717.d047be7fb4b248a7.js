"use strict";(self.webpackChunkdriver_work_state=self.webpackChunkdriver_work_state||[]).push([[717],{717:(H,C,p)=>{p.r(C),p.d(C,{MainContentModule:()=>X});var g=p(108),d=p(895),e=p(256),m=p(135),v=p(646);class _{constructor(i){this.id=i.id,this.eventTimestampStart=new Date(i.eventTimestamp)}}const w=JSON.parse('[{"id":1,"eventType":1,"eventCode":3,"eventTimestamp":"2020-11-19 05:00:00"},{"id":2,"eventType":1,"eventCode":2,"eventTimestamp":"2020-11-19 06:20:00"},{"id":3,"eventType":1,"eventCode":4,"eventTimestamp":"2020-11-19 12:04:00"},{"id":4,"eventType":1,"eventCode":3,"eventTimestamp":"2020-11-19 12:23:00"},{"id":5,"eventType":1,"eventCode":1,"eventTimestamp":"2020-11-19 23:16:00"}]');let u=(()=>{class r{constructor(){this.updateData=new m.X(null),this.lines=[]}initValue(){this.getDataFromJson().subscribe(t=>{t.map((n,a,s)=>{const o=new _(n);return this.setTimestampEnd(o,s,a),this.calcLineSize(o),this.lineByEventCode(o,n.eventCode),o.d=`M ${o.startX},${o.y} ${o.endX},${o.y}`,this.lines.push(o),n}),this.initSupportLines(),this.setNewEventValues(this.lines)})}setNewEventValues(t){this.updateData.next(t)}getDataFromJson(){return(0,v.of)(w)}setLastEndDate(t){const n=new Date(t);return n.setHours(23),n.setMinutes(59),n.setSeconds(59),n}lineByEventCode(t,n){switch(n){case 1:t.color="red",t.y=10,t.type="Off Duty",t.shortType="OFF";break;case 2:t.color="black",t.y=40,t.type="Sleeper Berth",t.shortType="SB";break;case 3:t.color="green",t.y=65,t.type="Driving",t.shortType="D";break;case 4:t.color="orange",t.y=90,t.type="OnDuty",t.shortType="ON"}}calcLineSize(t){!t?.eventTimestampEnd?.getTime()||(t.durationMinutes=Math.round((t?.eventTimestampEnd?.getTime()-t.eventTimestampStart?.getTime())/1e3/60),t.duration=Math.round(25*t.durationMinutes/60),t.startX=Math.round(25*t.eventTimestampStart.getHours()+t.eventTimestampStart.getMinutes()/60*25+t.eventTimestampStart.getSeconds()/60/60*25),t.endX=t.startX+t.duration)}setTimestampEnd(t,n,a){t.eventTimestampEnd=t.eventTimestampEnd=a+1>=n.length?this.setLastEndDate(t.eventTimestampStart):new Date(n[a+1].eventTimestamp)}initSupportLines(){this.lines.forEach((t,n,a)=>{n+1<a.length&&(t.supportLine={x:t.endX,y1:t.y,y2:a[n+1].y,color:a[n+1].color,d:`M ${t.endX},${t.y} ${t.endX},${a[n+1].y}`})})}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac}),r})(),b=(()=>{class r{constructor(){this.getDataFromChart=new m.X(null),this.getDataFromTable=new m.X(null)}setDataFromChart(t){this.getDataFromChart.next(t)}setDataFromTable(t){this.getDataFromTable.next(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const T=["svg"],E=["linesPath"];function L(r,i){if(1&r){const t=e.EpF();e.O4$(),e.TgZ(0,"g",57)(1,"path",58),e.NdJ("mousedown",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.dragAndDrop(a,"start"))}),e.qZA(),e.TgZ(2,"path",58),e.NdJ("mousedown",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.dragAndDrop(a,"end"))}),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(1),e.uIk("d",t.startDragPosition),e.xp6(1),e.uIk("d",t.endDragPosition)}}function D(r,i){if(1&r){const t=e.EpF();e.O4$(),e.TgZ(0,"path",59,60),e.NdJ("click",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.clickByLine(a))}),e.qZA()}if(2&r){const t=i.$implicit;e.MGl("id","line-",i.index+2,""),e.uIk("d",t.d)("stroke",t.color)}}function M(r,i){if(1&r&&(e.O4$(),e._UZ(0,"path",61)),2&r){const t=i.$implicit;e.MGl("id","helpline-",i.index+2,""),e.uIk("d",null==t||null==t.supportLine?null:t.supportLine.d)("stroke",null==t||null==t.supportLine?null:t.supportLine.color)}}let x=(()=>{class r{constructor(t,n,a){this.transferService=t,this.eventService=n,this.document=a,this.chartWidth=600,this.isShowDragLines=!1,this.lines=[],this.startDragPosition="",this.endDragPosition=""}ngOnInit(){this.updateDataSubscription=this.transferService.getDataFromTable.subscribe(t=>{this.linesPath?.forEach(n=>{Number(n.nativeElement.id.slice(5))===t&&(this.isShowDragLines&&(this.selectedLineElem?.classList?.remove("selected-line"),this.isShowDragLines=!this.isShowDragLines),this.clickOnLine(n.nativeElement))})}),this.mainDataSubscription=this.eventService.updateData.subscribe(t=>{t&&(this.lines=t)})}ngOnDestroy(){this.mainDataSubscription.unsubscribe(),this.updateDataSubscription.unsubscribe()}dragAndDrop(t,n){this.selectedDragLine=n,this.startDrag(t,t.target)}clickByLine(t){if(this.isShowDragLines)return this.selectedLineElem?.classList?.remove("selected-line"),this.isShowDragLines=!this.isShowDragLines,void this.transferService.setDataFromChart(null);this.clickOnLine(t.target,!0)}clickOnLine(t,n){const a=Number(t.getAttribute("id")?.slice(5));this.selectedLineElem=t,this.selectedLineElem.classList.add("selected-line");let s=t.getAttribute("d");this.setDragLinePositions(s),this.isShowDragLines=!this.isShowDragLines,n&&this.transferService.setDataFromChart(a)}setDragLinePositions(t){let{lineStartX:n,lineEndX:a}=this.getLinePosition(t);this.endDragPosition=`M ${a},0 ${a},105`,this.startDragPosition=`M ${n},0 ${n},105`}getLinePosition(t){const[,n,a]=t.split(" ");return{lineStartX:n.split(",")[0],lineStartY:n.split(",")[1],lineEndX:a.split(",")[0],lineEndY:a.split(",")[1]}}changeSelectedLine(t,n){const a=Number(t.getAttribute("id")?.slice(5)),s=t.getAttribute("d");let{lineStartX:o,lineStartY:l,lineEndX:h,lineEndY:f}=this.getLinePosition(s);switch(this.selectedDragLine){case"start":this.changeEventTime(a,o-n),this.changeSupportLine(a-1,n),this.changeSiblingLine(a-1,n),o=n;break;case"end":const Y=this.changeSiblingLine(a+1,n);this.changeEventTime(a+1,Y-n),this.changeSupportLine(a,n),h=n}t.setAttribute("d",`M ${o},${l} ${h},${f}`)}changeEventTime(t,n){let a=60*n*1e3*2.4;this.lines[t-2].eventTimestampStart=new Date(this.lines[t-2].eventTimestampStart.getTime()-a),this.eventService.setNewEventValues(this.lines)}changeSupportLine(t,n){this.svg.nativeElement.childNodes.forEach(a=>{if(1===a.nodeType&&Number(a.getAttribute("id")?.slice(9))===t){let{lineStartX:s,lineStartY:o,lineEndX:l,lineEndY:h}=this.getLinePosition(a.getAttribute("d")||"");switch(this.selectedDragLine){case"end":case"start":s=n,l=n}a.setAttribute("d",`M ${s},${o} ${l},${h}`)}})}changeSiblingLine(t,n){let a;return this.svg.nativeElement.childNodes.forEach(s=>{if(1===s.nodeType&&Number(s.getAttribute("id")?.slice(5))===t){let{lineStartX:o,lineStartY:l,lineEndX:h,lineEndY:f}=this.getLinePosition(s.getAttribute("d")||"");switch(a=o,this.selectedDragLine){case"end":o=n;break;case"start":h=n}s.setAttribute("d",`M ${o},${l} ${h},${f}`)}}),a}startDrag(t,n){t.preventDefault(),t.stopPropagation();let a=this.svg.nativeElement.createSVGPoint();a=a.matrixTransform(this.svg.nativeElement.getScreenCTM()?.inverse());const s=l=>{l.preventDefault(),a.x=l.clientX,a.y=l.clientY;let h=a.matrixTransform(this.svg.nativeElement.getScreenCTM()?.inverse());h.x<0&&(h.x=0),h.x>this.chartWidth&&(h.x=this.chartWidth),n.setAttribute("d",`M ${h.x},0 ${h.x},105`),this.changeSelectedLine(this.selectedLineElem,h.x)},o=l=>{this.document.removeEventListener("mousemove",s),this.document.removeEventListener("mouseup",o)};this.document.addEventListener("mousemove",s),this.document.addEventListener("mouseup",o)}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(b),e.Y36(u),e.Y36(d.K0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-chart"]],viewQuery:function(t,n){if(1&t&&(e.Gf(T,5),e.Gf(E,5)),2&t){let a;e.iGM(a=e.CRH())&&(n.svg=a.first),e.iGM(a=e.CRH())&&(n.linesPath=a)}},decls:84,vars:3,consts:[["viewBox","0 0 600 120",1,"chart"],["svg",""],[1,"chart__helpline"],["d","M 25,120 25,115"],["x","23","y","112"],["d","M 50,120 50,115"],["x","48","y","112"],["d","M 75,120 75,115"],["x","73","y","112"],["d","M 100,120 100,115"],["x","98","y","112"],["d","M 125,120 125,115"],["x","123","y","112"],["d","M 150,120 150,115"],["x","148","y","112"],["d","M 175,120 175,115"],["x","173","y","112"],["d","M 225,120 225,115"],["x","223","y","112"],["d","M 200,120 200,115"],["x","198","y","112"],["d","M 250,120 250,115"],["x","246","y","112"],["d","M 275,120 275,115"],["x","271","y","112"],["d","M 300,120 300,115"],["x","296","y","112"],["d","M 325,120 325,115"],["x","321","y","112"],["d","M 350,120 350,115"],["x","346","y","112"],["d","M 375,120 375,115"],["x","371","y","112"],["d","M 400,120 400,115"],["x","396","y","112"],["d","M 425,120 425,115"],["x","421","y","112"],["d","M 450,120 450,115"],["x","446","y","112"],["d","M 475,120 475,115"],["x","471","y","112"],["d","M 500,120 500,115"],["x","496","y","112"],["d","M 525,120 525,115"],["x","521","y","112"],["d","M 550,120 550,115"],["x","546","y","112"],["d","M 575,120 575,115"],["x","571","y","112"],[1,"chart__legend"],["stroke","red","x","10","y","15"],["stroke","black","x","10","y","40"],["stroke","green","x","10","y","65"],["stroke","orange","x","10","y","90"],["class","chart__drags",4,"ngIf"],["class","chart__line","fill","none","stroke-width","4",3,"id","click",4,"ngFor","ngForOf"],["class","chart__line-support","fill","none","stroke-width","1",3,"id",4,"ngFor","ngForOf"],[1,"chart__drags"],["stroke","green","stroke-width","3","fill","none",3,"mousedown"],["fill","none","stroke-width","4",1,"chart__line",3,"id","click"],["linesPath",""],["fill","none","stroke-width","1",1,"chart__line-support",3,"id"]],template:function(t,n){1&t&&(e.O4$(),e.TgZ(0,"svg",0,1)(2,"g",2),e._UZ(3,"path",3),e.TgZ(4,"text",4),e._uU(5,"1"),e.qZA(),e._UZ(6,"path",5),e.TgZ(7,"text",6),e._uU(8,"2"),e.qZA(),e._UZ(9,"path",7),e.TgZ(10,"text",8),e._uU(11,"3"),e.qZA(),e._UZ(12,"path",9),e.TgZ(13,"text",10),e._uU(14,"4"),e.qZA(),e._UZ(15,"path",11),e.TgZ(16,"text",12),e._uU(17,"5"),e.qZA(),e._UZ(18,"path",13),e.TgZ(19,"text",14),e._uU(20,"6"),e.qZA(),e._UZ(21,"path",15),e.TgZ(22,"text",16),e._uU(23,"7"),e.qZA(),e._UZ(24,"path",17),e.TgZ(25,"text",18),e._uU(26,"8"),e.qZA(),e._UZ(27,"path",19),e.TgZ(28,"text",20),e._uU(29,"9"),e.qZA(),e._UZ(30,"path",21),e.TgZ(31,"text",22),e._uU(32,"10"),e.qZA(),e._UZ(33,"path",23),e.TgZ(34,"text",24),e._uU(35,"11"),e.qZA(),e._UZ(36,"path",25),e.TgZ(37,"text",26),e._uU(38,"12"),e.qZA(),e._UZ(39,"path",27),e.TgZ(40,"text",28),e._uU(41,"13"),e.qZA(),e._UZ(42,"path",29),e.TgZ(43,"text",30),e._uU(44,"14"),e.qZA(),e._UZ(45,"path",31),e.TgZ(46,"text",32),e._uU(47,"15"),e.qZA(),e._UZ(48,"path",33),e.TgZ(49,"text",34),e._uU(50,"16"),e.qZA(),e._UZ(51,"path",35),e.TgZ(52,"text",36),e._uU(53,"17"),e.qZA(),e._UZ(54,"path",37),e.TgZ(55,"text",38),e._uU(56,"18"),e.qZA(),e._UZ(57,"path",39),e.TgZ(58,"text",40),e._uU(59,"19"),e.qZA(),e._UZ(60,"path",41),e.TgZ(61,"text",42),e._uU(62,"20"),e.qZA(),e._UZ(63,"path",43),e.TgZ(64,"text",44),e._uU(65,"21"),e.qZA(),e._UZ(66,"path",45),e.TgZ(67,"text",46),e._uU(68,"22"),e.qZA(),e._UZ(69,"path",47),e.TgZ(70,"text",48),e._uU(71,"23"),e.qZA()(),e.TgZ(72,"g",49)(73,"text",50),e._uU(74,"OFF"),e.qZA(),e.TgZ(75,"text",51),e._uU(76,"SB"),e.qZA(),e.TgZ(77,"text",52),e._uU(78,"D"),e.qZA(),e.TgZ(79,"text",53),e._uU(80,"ON"),e.qZA()(),e.YNc(81,L,3,2,"g",54),e.YNc(82,D,2,3,"path",55),e.YNc(83,M,1,3,"path",56),e.qZA()),2&t&&(e.xp6(81),e.Q6J("ngIf",n.isShowDragLines),e.xp6(1),e.Q6J("ngForOf",n.lines),e.xp6(1),e.Q6J("ngForOf",n.lines))},dependencies:[d.sg,d.O5],styles:[".chart[_ngcontent-%COMP%]{background:white;width:600px;height:120px;border-left:.1px solid #555;border-bottom:.1px solid #555;margin-left:10px;margin-right:10px}.chart__legend[_ngcontent-%COMP%]   text[_ngcontent-%COMP%]{font-size:14px!important}.chart__helpline[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke:gray;stroke-width:1;fill:none}.chart__helpline[_ngcontent-%COMP%]   text[_ngcontent-%COMP%]{font-size:8px}.chart__line[_ngcontent-%COMP%]{cursor:pointer}.chart__drags[_ngcontent-%COMP%]{padding:10px;cursor:ew-resize}.selected-line[_ngcontent-%COMP%]{stroke-width:8}"]}),r})();const Z=["tr"],A=function(r){return{color:r}};function O(r,i){if(1&r){const t=e.EpF();e.TgZ(0,"tr",1,2),e.NdJ("click",function(){const s=e.CHM(t).index,o=e.oxw();return e.KtG(o.setSelected(s+2,!0))}),e.TgZ(2,"td"),e._uU(3),e.TgZ(4,"span",3),e._uU(5),e.qZA(),e._uU(6,") "),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.ALo(9,"date"),e.qZA()()}if(2&r){const t=i.$implicit;e.s9C("id",i.index+2),e.xp6(3),e.hij("",t.type," ("),e.xp6(1),e.Q6J("ngStyle",e.VKq(8,A,t.color)),e.xp6(1),e.Oqu(t.shortType),e.xp6(3),e.Oqu(e.xi3(9,5,t.eventTimestampStart,"yyyy-MM-dd HH:mm"))}}let z=(()=>{class r{constructor(t,n){this.eventService=t,this.transferService=n}ngOnInit(){this.transferService.getDataFromChart.subscribe(t=>{this.setSelected(t)})}setSelected(t,n){const a=String(t);this.selectedElement?.id&&this.selectedElement.id!==a&&this.selectedElement?.classList.remove("selected"),this.rowList?.map(s=>{let o=s.nativeElement;o.id===a&&(this.selectedElement=o,this.selectedElement.classList.add("selected"),n&&this.transferService.setDataFromTable(t))})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(u),e.Y36(b))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-table"]],viewQuery:function(t,n){if(1&t&&e.Gf(Z,5),2&t){let a;e.iGM(a=e.CRH())&&(n.rowList=a)}},decls:9,vars:3,consts:[["class","table__row",3,"id","click",4,"ngFor","ngForOf"],[1,"table__row",3,"id","click"],["tr",""],[3,"ngStyle"]],template:function(t,n){1&t&&(e.TgZ(0,"table")(1,"thead")(2,"tr")(3,"th"),e._uU(4,"Event"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Time"),e.qZA()()(),e.YNc(7,O,10,10,"tr",0),e.ALo(8,"async"),e.qZA()),2&t&&(e.xp6(7),e.Q6J("ngForOf",e.lcZ(8,1,n.eventService.updateData)))},dependencies:[d.sg,d.PC,d.Ov,d.uU],styles:["table[_ngcontent-%COMP%]{font-family:arial,sans-serif;border-collapse:collapse;width:100%}thead[_ngcontent-%COMP%]{background-color:#add8e6}.table__row[_ngcontent-%COMP%]{cursor:pointer}.selected[_ngcontent-%COMP%]{background-color:#87cefa}td[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{text-align:left;padding:8px;border:1px solid #dddddd}"]}),r})();const F=[{path:"",component:(()=>{class r{constructor(t){this.eventService=t}ngOnInit(){this.eventService.initValue()}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(u))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-main-content"]],decls:7,vars:0,consts:[[1,"main"],[1,"main__title"],[1,"main-content"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div")(2,"h2",1),e._uU(3,"Driver work state"),e.qZA()(),e.TgZ(4,"div",2),e._UZ(5,"app-chart")(6,"app-table"),e.qZA()())},dependencies:[x,z],styles:[".main__title[_ngcontent-%COMP%]{margin-left:50px}.main-content[_ngcontent-%COMP%]{display:flex}"]}),r})()}];let k=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[g.Bz.forChild(F),g.Bz]}),r})();var R=p(579),W=p(751),U=p(577),j=p(4),P=p(900);const y=new e.OlP("GOOGLE_CHARTS_CONFIG"),I=new e.OlP("GOOGLE_CHARTS_LAZY_CONFIG",{providedIn:"root",factory:()=>{const r=(0,e.f3M)(y,e.XFs.Optional);return(0,v.of)({version:"current",safeMode:!1,...r||{}})}});let $=(()=>{class r{constructor(t,n,a){this.zone=t,this.localeId=n,this.config$=a,this.scriptSource="https://www.gstatic.com/charts/loader.js",this.scriptLoadSubject=new R.x}isGoogleChartsAvailable(){return!(typeof google>"u"||typeof google.charts>"u")}loadChartPackages(...t){return this.loadGoogleCharts().pipe((0,U.z)(()=>this.config$),(0,j.U)(n=>({version:"current",safeMode:!1,...n||{}})),(0,P.w)(n=>new W.y(a=>{google.charts.load(n.version,{packages:t,language:this.localeId,mapsApiKey:n.mapsApiKey,safeMode:n.safeMode}),google.charts.setOnLoadCallback(()=>{this.zone.run(()=>{a.next(),a.complete()})})})))}loadGoogleCharts(){if(this.isGoogleChartsAvailable())return(0,v.of)(void 0);if(!this.isLoadingGoogleCharts()){const t=this.createGoogleChartsScript();t.onload=()=>{this.zone.run(()=>{this.scriptLoadSubject.next(),this.scriptLoadSubject.complete()})},t.onerror=()=>{this.zone.run(()=>{console.error("Failed to load the google charts script!"),this.scriptLoadSubject.error(new Error("Failed to load the google charts script!"))})}}return this.scriptLoadSubject.asObservable()}isLoadingGoogleCharts(){return null!=this.getGoogleChartsScript()}getGoogleChartsScript(){return Array.from(document.getElementsByTagName("script")).find(n=>n.src===this.scriptSource)}createGoogleChartsScript(){const t=document.createElement("script");return t.type="text/javascript",t.src=this.scriptSource,t.async=!0,document.getElementsByTagName("head")[0].appendChild(t),t}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(e.R0b),e.LFG(e.soG),e.LFG(I))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac}),r})(),N=(()=>{class r{static forRoot(t={}){return{ngModule:r,providers:[{provide:y,useValue:t}]}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[$]}),r})(),q=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[u],imports:[d.ez,N]}),r})(),B=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[d.ez]}),r})(),X=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[g.Bz,q,d.ez,k,B]}),r})()}}]);